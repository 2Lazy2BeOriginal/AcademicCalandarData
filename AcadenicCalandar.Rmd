---
title: "Data Analysis About Academic Calandar"
author: "2Lazy2BeOriginal"
date: "2024-12-24"
output:
  html_document:
    df_print: paged
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(tinytex.verbose = TRUE)
```
This document used Python + Selenium to collect the course codes and their respective department and faculty. We are interested in finding the most common course code among all the classes and within each faculty. In addition, this will iterate through each department and compare to the other departments to count how many codes are shared among the two. 

**Note**: There are many courses that are no longer offered at the UofM and are still counted in this list. The Academic Calendar does not differentiate between which current classes offered or not. 

```{r create table and Vec, echo = FALSE}
# use read.delim for sep that is not space or comma

setwd("/Users/2lazy2beoriginal/PycharmProjects/GetAcademicCalandar")
# /Users/2lazy2beoriginal/PycharmProjects/GetAcademicCalandar/output2.txt
factors <- c("dept", "code", "faculty", "courseName")
all_courses <- read.delim("./output2.txt", sep = "|", col.names = factors)
# rename some faculty to be better
all_courses$faculty[all_courses$faculty  == "management-business"] <- "business"
all_courses$faculty[all_courses$faculty  == "agricultural-food-sciences-agriculture"] <- "agriculture"
all_courses$faculty[all_courses$faculty  == "art"] <- "school-of-art"
all_courses$faculty[all_courses$faculty  == "rady"] <- "health sciences"
all_courses$faculty[all_courses$faculty  == "kinesiology-recreation-management"] <- "kin-rec"

all_faculties <- unique(all_courses$faculty)
all_dept <- unique(all_courses$dept)

numFacs <- length(all_faculties)
```

## What is the most common course number? 

```{r finding top 5, echo = FALSE}
sortedCodes <- sort(table(code = all_courses$code), decreasing = TRUE)
sortedCodes[1:10]
```
```{r plot Code divide by fac, echo = FALSE}
library('forcats')
library(ggplot2)
topCodes <- names(sortedCodes[1:10])
topCodesDf <- all_courses[which(all_courses$code %in% topCodes),]
topCodesDf <- topCodesDf[order(topCodesDf$faculty),]
# prevent R from thinking these are numbers and treat as string
topCodesDf$code <- as.character(topCodesDf$code)
# make colour coding less annoying
cherryPickFac <- c("asper", "engineering", "science", "health sciences", "arts")
topCodesDf$faculty[!topCodesDf$faculty %in% cherryPickFac] <- "other"
  ggplot(topCodesDf, aes(code)) + geom_bar(aes(fill = faculty)) +
  labs(title = "Most common course codes barplot",
       subtitle = "colour coded by faculty")
  
```

## Table of the courses and the names 

```{r echo = FALSE, results = 'asis', warning=FALSE, echo = FALSE}
# this threw a depreciated with xfun::attr
#topCodesDf <- all_courses[which(all_courses$code %in% top5),]
#  topCodesDf %>% 
#    dplyr::group_by(code) %>% 
#  kbl(row.names = FALSE, align = "c") %>% 
#    add_header_above(c(plotTitle = 4)) %>% 
#      kable_styling() %>% 
#    print()
  
library(knitr)
library(kableExtra)
makeTableForTopCodes <- function(x) {
  all4010 <- all_courses[which(all_courses$code == x),c("dept", "faculty", "courseName")]
  all4010 <- all4010[order(all4010$faculty),]
  all4010 <- cbind(1:nrow(all4010),all4010)
  plotTitle <- paste("Courses with code ",x)
  colnames(all4010) <- c("Count", "Department", "Faculty", "Course Name")
  kbl(all4010, row.names = FALSE, align = "c") %>% 
    add_header_above(c(plotTitle = 4)) %>% 
      kable_styling() %>% 
    print()
}

top5 <- names(sortedCodes[1:5])
for (i in 1:5) {
  makeTableForTopCodes(top5[i])
}
```
So (perhaps surprisingly) the most common course code is not 1000 but 4010 with 24 departments using it in their classes. 

## What is the most common course number by faculty

```{r findMostCommonByFac, echo = FALSE}
library(stringr)
# get the top 5 classes in each faculty, excluding law and music
getMostCommonCodeByFacs <- function(fac) {
  tempDf <- all_courses[which(all_courses$faculty == fac),]
  sort(table(code = tempDf$code), decreasing = TRUE)[1:5]
}
moreOneFacVec <- all_faculties[!all_faculties %in% c("music", "law", "social-work")]
splitByFacCodes <- lapply(moreOneFacVec,getMostCommonCodeByFacs)
names(splitByFacCodes) <- moreOneFacVec
# wrap into a Df 
mostCommonByFacDf <- t(as.data.frame(splitByFacCodes))
# duplicate so we can table the data
moreOneFacVec2 = c()
for (i in 1:length(moreOneFacVec)) {
  moreOneFacVec2 <- c(moreOneFacVec2, moreOneFacVec[i], moreOneFacVec[i])
}
mostCommonByFacDf <- cbind(rep(c("Code", "Frequency"), length(moreOneFacVec)),mostCommonByFacDf,moreOneFacVec2)
```

```{r showTable, echo = FALSE, warning=FALSE}
library(kableExtra)
# -7 is the column of the groups
kbl(mostCommonByFacDf[,-7], row.names = FALSE) %>% kable_styling(bootstrap_options = c("striped", "hover")) %>% 
# add headers
add_header_above(c(" " = 1, "1st" = 1, "2nd" = 1, "3rd" = 1, "4th" = 1, "5th" = 1)) %>% add_header_above(c("Faculty", "Placements by common frequency" = 5)) %>% 
add_header_above(c("Most common course codes grouped by Department" = 6)) %>%
# add colours to the cols
  column_spec(2, background = "#FFDF00") %>%
  column_spec(3, background = "silver") %>%
  column_spec(4, background = "#CE8946") %>%
# add rowNames
pack_rows(index = table(moreOneFacVec2), label_row_css = "background-color: #666; color: #fff;") %>%
# add footnote omiting
footnote(general = "music, law, and social-work are omitted as they only have one course prefix")
```
The arts faculty is the largest so it makes sense that it has the most departments with the same course codes. There are 

## Which department has the most classes? 

```{r echo = FALSE}
# Do later but add porportion of courses offered
library(gt)
sortByDept <- sort(table(Department = all_courses$dept),decreasing = TRUE)[1:15]
gt_tbl <- gt(as.data.frame(sortByDept))
gt_tbl <- 
  gt_tbl |>
  tab_header(
    title = md("**The departments with number of courses offered**"),
    subtitle = md("These may include courses *no longer availiable*")
  )
# Show the gt Table
gt_tbl
```
The caviet is that some faculties only fall under one course code, and hence 

## Porportion of classes by faculty
```{r pie chart, echo = FALSE}

pie(table(all_courses$faculty),col=rainbow(length(all_faculties)), radius = 1.05)
getProp <- function(x) {
  tempDf <- all_courses[which(all_courses$faculty == x),]
  p <- round(nrow(tempDf) / nrow(all_courses), digits = 3)
  paste(x, "porportion is", p)
}

sapply(all_faculties, getProp)
#pie3D(table(all_courses$faculty), explode=0.1, labels = all_faculties)
```

## What is the shortest and longest course name

```{r}
# do average word length by faculty/dept and also most common words

library(tokenizers)
# Count number of words in each courseName
word_count <- sapply(strsplit(all_courses$courseName, "\\s+"), length)
# Count number of characters in each courseName
char_count <- nchar(all_courses$courseName)

withWordCountDf <- all_courses[order(word_count, char_count), ]
withWordCountDf <- cbind(withWordCountDf, numWords = sort(word_count))

# get top 15 shortest and longest course names
head(withWordCountDf, 15)
tail(withWordCountDf, 15)
# find mean word length of each class 
meanWordLen <- sapply(all_dept, function(x) {
  mean(withWordCountDf[which(withWordCountDf$dept == x), "numWords"])
})
hist(meanWordLen)
```
## What is the most common word 

```{r findMostCommonWord, echo = FALSE}
# 1. Collapse all strings into one
all_text <- paste(withWordCountDf$courseName, collapse = " ")
# 2. Split into individual words
words <- unlist(strsplit(all_text, "\\s+"))
# 3. Convert to lowercase (optional, to avoid case sensitivity)
words <- tolower(words)
# 4. Count word frequency
word_freq <- table(words)
```

## What happens if you discard most of the words 

## 2890, 3890, 4890 are co op work terms 

## Which department shares the most classes with another


the `table()` function in R groups repeated entries and returns the frequency. Each department has a unique code that cooresponds to a particular class. (MATH 1500 always means Introduction to Calculus, PHIL 1300 always means Introduction to Logic). In other words, each department course code only appears once.

And if we combine the two departments and table the data, a frequency of two automatically implies the code exists in both departments. Then we simply count how many codes have a count of two.

```{r createMostCommonMatrix, echo = FALSE}
# BIOE appears twice in both agriculture and bio engineering

# Only departments with ten or more classes are considered 
deptOnly <- names(which(table(all_courses$dept) > 10))
# symmetric matrix where each i,j entry is a pair of departments
mostCommonMatrix = matrix(nrow = length(deptOnly), ncol = length(deptOnly), dimnames = list(deptOnly, deptOnly))

# iterate through each possible pair
for (y in 1:length(deptOnly)) {
  for (x in 1:length(deptOnly)) {
    # name for department 1 and 2 
    target1 <- colnames(mostCommonMatrix)[[x]]
    target2 <- colnames(mostCommonMatrix)[[y]]
    # combine the two department codes
    combinedVec = c(all_courses$code[all_courses$dept == target1], all_courses$code[all_courses$dept == target2])
    temp <- table(combinedVec)
    # The case where x = y is always the number of classes but set to 0 to make calculations easier
    if (x == y) {
      mostCommonMatrix[y,x] <- 0
    } else {
      # count how many codes are duplicated, implies the 2 department share same code
      mostCommonMatrix[y,x] <- sum(temp == 2)
    }
  }
}
which(mostCommonMatrix == max(mostCommonMatrix), arr.ind=TRUE)
max(mostCommonMatrix)
```

The most two departments with the most course codes in common among the two are **History** and **Religion** with 26 codes shared among the two

## What about the other departments?

```{r, scho = FALSE}
# this will keep track of a faculty and match with a different department
indices = data.frame(from = deptOnly, to = NA, freq = NA)
for (i in 1:length(deptOnly)) {
  # each row is a department
  currRow <- mostCommonMatrix[i,]
  # we order the data since it tells us the index since it is how we backtrack to the department name
  keyIndex <- order(currRow)[length(deptOnly)]
  matchingDept <- colnames(mostCommonMatrix)[[keyIndex]]
  count <- max(currRow)
  
  indices$to[indices$from == deptOnly[i]] <- matchingDept
  indices$freq[indices$from == deptOnly[i]] <- count
}

indices <- indices[order(indices$freq),]
```

```{r echo = FALSE}
library(gt)
gt_tbl <- gt(tail(indices, 25))
gt_tbl <- 
  gt_tbl |>
  #dplyr::filter(Freq >= 10) 
  tab_header(
    title = md("**Each department and a different department corresponding most common course code**"),
  )
# Show the gt Table
gt_tbl
```

# Graph Theory

### Each edge is connected if there is no same digit and diff dept
### Note to self (try to make this into a graph and see of its hamiltonian, k connected etc)
### Try to see if faculty is planar or chromanic number
### Create adj matrix for each course (prefix + code) and add an edge if code is the same
### Try to implement google search algorithm by using porportion of matched codes?
